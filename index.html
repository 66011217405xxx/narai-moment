<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Narai Moment - LOPBURI</title>
<style>
  body{margin:0;font-family:system-ui, -apple-system, sans-serif;background:#e2e0db;text-align:center;color:#5a544e}
  .box{max-width:380px;margin:15px auto;background:#fff;padding:20px;border-radius:28px;box-shadow:0 15px 40px rgba(0,0,0,0.1)}
  canvas{width:100%;aspect-ratio:9/16;border-radius:4px;touch-action:none;background:#f5f5f7;cursor: move;}
  .tools{margin-top:15px;display:flex;flex-wrap:wrap;justify-content:center;gap:6px}
  button, label{padding:10px 14px;border:none;border-radius:12px;background:#8e7f71;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:0.2s}
  button:hover{background:#76695d}
  .btn-del{background:#a68b7c} 
  input[type="file"]{display: none;}
  h4{margin:0 0 12px 0;letter-spacing:3px;font-weight:400;color:#8e7f71; font-size: 14px;}
</style>
</head>
<body>

<div class="box">
  <h4>N A R A I ‚Ä¢ M O M E N T</h4>
  <canvas id="cv" width="1080" height="1920"></canvas>

  <div class="tools">
    <label for="imgs">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
    <input type="file" id="imgs" accept="image/*" multiple>
    <button onclick="mode='move'">‡∏¢‡πâ‡∏≤‡∏¢/‡∏õ‡∏£‡∏±‡∏ö</button>
    <button onclick="mode='pick'">‡∏•‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
    <button onclick="addText()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    <button class="btn-del" onclick="deleteItem()">‚ùå ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    <button class="btn-del" onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    <button style="background:#5a544e; width: 100%; margin-top: 5px;" onclick="saveImg()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
  </div>
</div>

<script>
const cv=document.getElementById("cv"),ctx=cv.getContext("2d");
let items=[],drag=-1,mode="move";

function draw(){
  // 1. ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß‡∏Ñ‡∏ß‡∏±‡∏ô‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà
  ctx.fillStyle="#F5F5F7"; 
  ctx.fillRect(0,0,cv.width,cv.height);

  // 2. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á
  drawLuxuryFrame();

  // 3. ‡∏ß‡∏≤‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ (‡∏£‡∏π‡∏õ/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°)
  items.forEach((it, idx)=>{
    ctx.save();
    if(it.type=="img"){
      ctx.drawImage(it.img,it.x,it.y,it.w,it.h);
    }else{
      ctx.font=`${it.weight || '600'} ${it.size}px 'Times New Roman', serif`;
      ctx.fillStyle="#8e7f71";
      ctx.textAlign="center";
      ctx.fillText(it.text,it.x,it.y);
    }
    // ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    if(drag === idx) {
        ctx.strokeStyle = "rgba(142, 127, 113, 0.5)";
        ctx.setLineDash([10, 10]);
        if(it.type=="img") ctx.strokeRect(it.x, it.y, it.w, it.h);
    }
    ctx.restore();
  });
}

function drawLuxuryFrame() {
    const marginW = 50, marginH = 60, gap = 20, color = "#8e7f71";
    ctx.strokeStyle = color;
    
    // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö Double Border
    ctx.lineWidth = 10;
    ctx.strokeRect(marginW, marginH, cv.width - (marginW*2), cv.height - (marginH*2));
    ctx.lineWidth = 2;
    ctx.strokeRect(marginW + gap, marginH + gap, cv.width - ((marginW+gap)*2), cv.height - ((marginH+gap)*2));

    // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LOPBURI NARAI MOMENT ‡∏ï‡∏£‡∏á‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö ---
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.font = "italic 400 45px 'Times New Roman', serif";
    ctx.letterSpacing = "6px";
    // ‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    ctx.fillText("LOPBURI NARAI MOMENT", cv.width/2, marginH + 180);
    
    // ‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏±‡πà‡∏ô‡∏à‡∏≤‡∏á‡πÜ ‡πÉ‡∏ï‡πâ‡∏ä‡∏∑‡πà‡∏≠
    ctx.beginPath();
    ctx.moveTo(cv.width/2 - 120, marginH + 220);
    ctx.lineTo(cv.width/2 + 120, marginH + 220);
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.letterSpacing = "0px";
}

function deleteItem() {
    if(drag !== -1) {
        items.splice(drag, 1);
        drag = -1;
        draw();
    } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
    }
}

function clearAll() {
    if(confirm("‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        items = [];
        drag = -1;
        draw();
    }
}

document.getElementById("imgs").onchange=e=>{
  [...e.target.files].forEach(f=>{
    const i=new Image();
    i.onload=()=>{
      const scale = Math.min(800 / i.width, 800 / i.height);
      const w = i.width * scale, h = i.height * scale;
      // ‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      items.push({type:"img", img:i, x:cv.width/2-w/2, y:cv.height/2-h/4, w:w, h:h});
      draw();
    }
    i.src=URL.createObjectURL(f);
  });
};

function addText(){
  const t=prompt("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢:");
  if(t) {
      items.push({type:"text", text:t, x:cv.width/2, y:1750, size:45});
      draw();
  }
}

function pos(ev){
  const r=cv.getBoundingClientRect();
  const cx = ev.touches ? ev.touches[0].clientX : ev.clientX;
  const cy = ev.touches ? ev.touches[0].clientY : ev.clientY;
  return { x:(cx-r.left)*cv.width/r.width, y:(cy-r.top)*cv.height/r.height };
}

function hit(p,it){
  if(it.type=="img") return p.x>it.x&&p.x<it.x+it.w&&p.y>it.y&&p.y<it.y+it.h;
  return Math.abs(p.x-it.x)<250 && Math.abs(p.y-it.y)<60;
}

function start(e){
  const p=pos(e); drag=-1;
  for(let i=items.length-1; i>=0; i--){ if(hit(p,items[i])){ drag=i; break; } }
  if(mode=="pick" && drag!=-1 && items[drag].type=="img"){ removeBg(items[drag],p); drag=-1; }
  draw();
}

function moveEv(e){
  if(mode!="move"||drag==-1) return;
  const p=pos(e);
  if(items[drag].type=="img"){ items[drag].x=p.x-items[drag].w/2; items[drag].y=p.y-items[drag].h/2; }
  else { items[drag].x=p.x; items[drag].y=p.y; }
  draw();
}

cv.addEventListener("mousedown",start);
cv.addEventListener("mousemove",moveEv);
cv.addEventListener("mouseup",()=>{});
cv.addEventListener("touchstart",start,{passive:false});
cv.addEventListener("touchmove",e=>{e.preventDefault();moveEv(e)},{passive:false});

function removeBg(item,p){
  const temp=document.createElement("canvas");
  temp.width=item.w; temp.height=item.h;
  const tctx=temp.getContext("2d");
  tctx.drawImage(item.img,0,0,item.w,item.h);
  const imgData=tctx.getImageData(0,0,item.w,item.h);
  const pxX=Math.floor(p.x-item.x), pxY=Math.floor(p.y-item.y);
  const idx=(pxY*item.w+pxX)*4;
  const r=imgData.data[idx], g=imgData.data[idx+1], b=imgData.data[idx+2];
  for(let i=0;i<imgData.data.length;i+=4){
    if(Math.abs(imgData.data[i]-r)+Math.abs(imgData.data[i+1]-g)+Math.abs(imgData.data[i+2]-b)<45) imgData.data[i+3]=0;
  }
  tctx.putImageData(imgData,0,0);
  const ni=new Image(); ni.onload=()=>{item.img=ni;draw()}; ni.src=temp.toDataURL();
}

function saveImg(){
  const a=document.createElement("a");
  a.download="lopburi_narai_collage.png";
  a.href=cv.toDataURL("image/png");
  a.click();
}

draw();
</script>
</body>
</html>